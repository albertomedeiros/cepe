tinymce.PluginManager.add("olho",function(n){function e(n,e){var t=n;for(var o in e)t=t.replace("{"+o+"}",e[o]);return t}function t(){var t=n.selection.getNode(),o="",l="SPAN"==t.tagName&&-1!==n.dom.getAttrib(t,"class").indexOf("olhoWrap"),a=-1!==t.className.indexOf("olhoWrap")?t.childNodes[0].firstChild.nodeValue.replace(/[^0-9]/g,""):t.childNodes[0];l&&(o=t.name||decodeURIComponent(t.getAttribute("data-olho"))||""),n.windowManager.open({title:"Insert a contents",id:"olho-dialog",body:{type:"textbox",name:"name",multiline:!0,minWidth:520,minHeight:100,value:o},onSubmit:function(t){var o,l=t.data.name,i='<span class="olhoWrap matler-olho" id="#wko_ft{FOOTNOTE_INDEX}" contenteditable="false" data-olho="'+encodeURIComponent(l)+'"><button class="olhoBtn">{FOOTNOTE_INDEX}</button></span>',r=n.getDoc().querySelectorAll(".olhoBtn"),c=r.length,h=function(n){function e(n){return n.nextAll().find(".olhoBtn").length>0?n.next().hasClass("olhoBtn")?n.next().children().children():n.nextAll().find(".olhoBtn"):"BODY"==n.prop("nodeName")?[]:e(n.parent())}function t(n,e){if(!e)return!1;if(e)return e;var o=null;return e.children().each(function(){e&&(o=t(n,$(this)))}),o}return function(n,o){for(var l=e(o);0!==l.length;){var a=t(n,l);if(null!==a)return a;l=e(l)}return l}(".olhoBtn",n)}($(n.selection.getRng().endContainer));if(h.length){h=h[0];var d;for(d=0;d<c&&h!=r[d];d++);a<c?o=e(i,{FOOTNOTE_INDEX:$(r[a-1]).html()}):(o=e(i,{FOOTNOTE_INDEX:$(r[d]).html()}),n.selection.collapse(0))}else o=e(i,{FOOTNOTE_INDEX:c+1}),n.selection.collapse(0);n.execCommand("mceInsertContent",!1,o),$(n.getDoc()).find(".olhoBtn").each(function(n){$(this).text("Olho "+(n+1)),$(this).parent().attr("id","#wko_ft"+(n+1))})}})}n.addCommand("mceOlho",t),n.addButton("olho",{title:"Olho",image:tinyMCE.baseURL+"/plugins/olho/img/olho.gif",onclick:t,stateSelector:"span.olhoWrap"})});